name: SAST scanning
on:
    push:
      branches: [ "main" ]
      # paths:
      # - '**.cs'
      # - '**.csproj'
    pull_request:
      branches: [ "main" ]
      # paths:
      # - '**.cs'
      # - '**.csproj'
    # schedule:
    # - cron: '0 8 * * 4'
jobs:
  sast-scan:
    runs-on: ${{matrix.os}}
    strategy:
      matrix:
        os: [ubuntu-latest]
        languages: ['csharp']

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 8.0.x
    - name: nuget setup
      uses: nuget/setup-nuget@04b0c2b8d1b97922f67eca497d7cf0bf17b8ffe1
    - name: msbuild setup
      uses: microsoft/setup-msbuild@v1.0.2

    - name: Set up projects for analysis
      uses: security-code-scan/security-code-scan-add-action@f8ff4f2763ed6f229eded80b1f9af82ae7f32a0d

    - name: Restore dependencies
      run: dotnet restore
    - name: Build
      run: dotnet build --no-restore
    - name: Test
      run: dotnet test --no-build --verbosity normal
    - name: Current directory
      run: |
        echo ${{ github.workspace }}

    - name: Convert sarif for uploading to GitHub
      uses: security-code-scan/security-code-scan-results-action@cdb3d5e639054395e45bf401cba8688fcaf7a687

    - name: Upload sarif
      uses: github/codeql-action/upload-sarif@v3